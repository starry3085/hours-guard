<!--存储管理页面-->
<view class="container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">存储管理</text>
    <text class="subtitle">数据存储状态与管理工具</text>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading">
    <text>加载中...</text>
  </view>

  <!-- 存储使用情况 -->
  <view wx:else class="section">
    <view class="section-title">存储使用情况</view>
    <view class="info-card">
      <view class="info-row">
        <text class="info-label">记录数量</text>
        <text class="info-value">{{storageInfo.recordCount}}条</text>
      </view>
      <view class="info-row">
        <text class="info-label">存储使用</text>
        <text class="info-value">{{storageInfo.totalSize}}KB / {{storageInfo.limitSize}}KB</text>
      </view>
      <view class="info-row">
        <text class="info-label">使用率</text>
        <text class="info-value {{storageInfo.usagePercent > 80 ? 'warning' : ''}}">{{storageInfo.usagePercent}}%</text>
      </view>
      
      <!-- 使用率进度条 -->
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{storageInfo.usagePercent}}%"></view>
      </view>
    </view>
  </view>

  <!-- 健康状态 -->
  <view class="section">
    <view class="section-title">健康状态</view>
    <view class="health-card {{healthReport.isHealthy ? 'healthy' : 'unhealthy'}}">
      <view class="health-status">
        <text class="status-icon">{{healthReport.isHealthy ? '✓' : '⚠'}}</text>
        <text class="status-text">{{healthReport.isHealthy ? '存储状态正常' : '发现存储问题'}}</text>
      </view>
      
      <!-- 问题列表 -->
      <view wx:if="{{healthReport.issues && healthReport.issues.length > 0}}" class="issues">
        <text class="issues-title">发现问题:</text>
        <view wx:for="{{healthReport.issues}}" wx:key="index" class="issue-item">
          <text>• {{item}}</text>
        </view>
      </view>
      
      <!-- 建议列表 -->
      <view wx:if="{{healthReport.suggestions && healthReport.suggestions.length > 0}}" class="suggestions">
        <text class="suggestions-title">建议操作:</text>
        <view wx:for="{{healthReport.suggestions}}" wx:key="index" class="suggestion-item">
          <text>• {{item}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 管理操作 -->
  <view class="section">
    <view class="section-title">管理操作</view>
    
    <view class="action-grid">
      <view class="action-item" bindtap="onCreateBackup">
        <text class="action-icon">💾</text>
        <text class="action-text">手动备份</text>
        <text class="action-desc">创建数据备份</text>
      </view>
      
      <view class="action-item" bindtap="onOptimizeStorage">
        <text class="action-icon">🔧</text>
        <text class="action-text">优化存储</text>
        <text class="action-desc">清理重复数据</text>
      </view>
      
      <view class="action-item" bindtap="onCleanupData">
        <text class="action-icon">🗑️</text>
        <text class="action-text">清理数据</text>
        <text class="action-desc">删除历史记录</text>
      </view>
      
      <view class="action-item" bindtap="onViewErrorLog">
        <text class="action-icon">📋</text>
        <text class="action-text">错误日志</text>
        <text class="action-desc">查看系统日志</text>
      </view>
      
      <view class="action-item" bindtap="onExportStorageInfo">
        <text class="action-icon">📤</text>
        <text class="action-text">导出报告</text>
        <text class="action-desc">存储状态报告</text>
      </view>
      
      <view class="action-item danger" bindtap="onResetAllData">
        <text class="action-icon">⚠️</text>
        <text class="action-text">重置数据</text>
        <text class="action-desc">清空所有数据</text>
      </view>
    </view>
  </view>

  <!-- 使用提示 -->
  <view class="section">
    <view class="section-title">使用提示</view>
    <view class="tips-card">
      <view class="tip-item">
        <text class="tip-icon">💡</text>
        <text class="tip-text">建议定期导出备份文件，避免数据丢失</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">💡</text>
        <text class="tip-text">存储使用率超过80%时建议清理历史数据</text>
      </view>
      <view class="tip-item">
        <text class="tip-icon">💡</text>
        <text class="tip-text">优化存储可以提高应用运行速度</text>
      </view>
    </view>
  </view>
</view>