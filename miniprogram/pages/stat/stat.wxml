<view class="page-container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">工时统计</text>
  </view>

  <!-- 月份显示和选择 -->
  <view class="month-display" bindtap="openDatePicker">
    <view class="picker-icon">
      <view class="calendar-icon"></view>
    </view>
    <text class="month-text">{{currentMonth}}</text>
  </view>
  
  <!-- 自定义日期选择器弹窗 -->
  <view class="date-picker-overlay {{showDatePicker ? 'show' : ''}}" wx:if="{{showDatePicker}}">
    <view class="date-picker-modal">
      <view class="date-picker-header">
        <text class="date-picker-title">选择年月</text>
        <view class="date-picker-close" bindtap="closeDatePicker">×</view>
      </view>
      
      <view class="date-picker-body">
        <!-- 年份选择区域 -->
        <view class="year-month-grid">
          <block wx:for="{{yearList}}" wx:key="*this">
            <view class="year-item {{tempYear === item ? 'active' : ''}}" 
                  bindtap="selectYear" 
                  data-year="{{item}}">
              {{item}}
            </view>
          </block>
        </view>
        
        <!-- 月份选择区域 -->
        <view class="year-month-grid" style="margin-top: 30rpx;">
          <block wx:for="{{monthList}}" wx:key="*this">
            <view class="month-item {{tempMonth === item ? 'active' : ''}}" 
                  bindtap="selectMonth" 
                  data-month="{{item}}">
              {{item}}月
            </view>
          </block>
        </view>
      </view>
      
      <view class="date-picker-footer">
        <view class="picker-btn picker-btn-cancel" bindtap="closeDatePicker">取消</view>
        <view class="picker-btn picker-btn-confirm" bindtap="confirmDateSelection">确定</view>
      </view>
    </view>
  </view>

  <!-- 统计区域 -->
  <view class="stats-section" wx:if="{{list.length > 0}}">
    <view class="stats-card">
      <!-- 只有当选择的是当前月份时才显示本周统计 -->
      <view class="stats-row" wx:if="{{isCurrentMonth}}">
        <view class="stat-item">
          <text class="stat-label">本周总工时</text>
          <text class="stat-value">{{weeklyStats.totalHours}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">本周平均工时</text>
          <text class="stat-value">{{weeklyStats.avgHours}}</text>
        </view>
      </view>
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-label">本月平均工时</text>
          <text class="stat-value">{{monthlyStats.avgHours}}</text>
        </view>
        <view class="stat-item">
          <text class="stat-label">本月打卡天数</text>
          <text class="stat-value">{{monthlyStats.workDays}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 记录列表 -->
  <view class="records-section" wx:if="{{list.length > 0}}">
    <view class="record-card">
      <view class="list-header">
        <text class="header-date">日期</text>
        <text class="header-time">上班</text>
        <text class="header-time">下班</text>
        <text class="header-workhours">日工时</text>
      </view>
      
      <scroll-view scroll-y class="record-list" enable-back-to-top>
        <view wx:for="{{list}}" wx:key="date" class="record-row">
          <view class="cell-date">
            <text class="date-text">{{item.displayDate}}</text>
            <text class="weekday">{{item.weekday ? item.weekday : ''}}</text>
          </view>
          
          <view class="cell-time" bindtap="onEditTime" data-type="on" data-date="{{item.date}}">
            <view class="time-container">
              <text class="time-text {{item.on ? 'has-time' : 'no-time'}}">{{item.on ? item.on : '未打卡'}}</text>
            </view>
          </view>
          
          <view class="cell-time" bindtap="onEditTime" data-type="off" data-date="{{item.date}}">
            <view class="time-container">
              <text class="time-text {{item.off ? 'has-time' : 'no-time'}}">{{item.off ? item.off : '未打卡'}}</text>
            </view>
          </view>
          
          <view class="cell-workhours">
            <text class="time-text work-hours {{item.workHours ? 'has-time' : 'no-time'}}">{{item.workHours ? item.workHours : '-'}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>



  <!-- 时间选择器弹窗 -->
  <view wx:if="{{showPicker}}" class="picker-overlay">
    <view class="picker-modal">
      <view class="picker-header">
        <text class="picker-cancel" bindtap="onPickerCancel">取消</text>
        <text class="picker-title">修改{{pickerType === 'on' ? '上班' : '下班'}}时间</text>
        <text class="picker-confirm" bindtap="onPickerConfirm">确定</text>
      </view>
      
      <view class="picker-body">
        <picker-view 
          class="picker-view"
          value="{{pickerValue}}" 
          bindchange="onPickerChange">
          <picker-view-column>
            <view wx:for="{{hours}}" wx:key="*this" class="picker-item">{{item}}</view>
          </picker-view-column>
          <picker-view-column>
            <view wx:for="{{minutes}}" wx:key="*this" class="picker-item">{{item}}</view>
          </picker-view-column>
        </picker-view>
        
        <view class="picker-indicator">
          <text class="time-display">{{hours[pickerValue[0]]}}:{{minutes[pickerValue[1]]}}</text>
        </view>
      </view>
    </view>
  </view>
</view>