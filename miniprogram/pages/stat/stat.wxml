<view class="page-container">
  <!-- 页面标题 -->
  <view class="header">
    <text class="title">统计分析</text>
    <text class="subtitle">{{currentMonth}}</text>
  </view>

  <!-- 统计卡片 -->
  <view class="stats-section" wx:if="{{list.length > 0}}">
    <view class="stats-grid">
      <view class="stat-card">
        <text class="stat-number">{{monthDays}}</text>
        <text class="stat-label">打卡天数</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{totalMonthHours}}</text>
        <text class="stat-label">本月总时长(h)</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{weekHours}}</text>
        <text class="stat-label">本周时长(h)</text>
      </view>
      <view class="stat-card">
        <text class="stat-number">{{avgMonthDailyHours}}</text>
        <text class="stat-label">日均时长(h)</text>
      </view>
    </view>
  </view>

  <!-- 记录列表 -->
  <view class="records-section">
    <view class="section-header">
      <!-- Removed redundant title -->
      <text class="record-count" wx:if="{{list.length > 0}}">共{{list.length}}条</text>
    </view>

    <view class="empty-state" wx:if="{{list.length === 0}}">
      <text class="empty-text">本月暂无打卡记录</text>
      <text class="empty-hint">去打卡页面进行打卡吧</text>
    </view>

    <scroll-view scroll-y class="record-list" wx:else enable-back-to-top>
      <view class="list-header">
        <text class="header-date">日期</text>
        <text class="header-time">上班</text>
        <text class="header-time">下班</text>
        <text class="header-duration">时长</text>
        <text class="header-action">操作</text>
      </view>
      
      <view wx:for="{{list}}" wx:key="date" class="record-row">
        <view class="cell-date">
          <text class="date-text">{{item.date}}</text>
          <text class="weekday">{{item.weekday || ''}}</text>
        </view>
        
        <view class="cell-time" bindtap="onEditTime" data-type="on" data-date="{{item.date}}">
          <text class="time-text {{item.on ? 'has-time' : 'no-time'}}">{{item.on || '--:--'}}</text>
          <text class="edit-hint" wx:if="{{item.on}}"></text>
        </view>
        
        <view class="cell-time" bindtap="onEditTime" data-type="off" data-date="{{item.date}}">
          <text class="time-text {{item.off ? 'has-time' : 'no-time'}}">{{item.off || '--:--'}}</text>
          <text class="edit-hint" wx:if="{{item.off}}"></text>
        </view>
        
        <view class="cell-duration">
          <text class="duration-text">{{item.workHoursText}}</text>
        </view>
        
        <view class="cell-action">
          <text class="delete-btn" bindtap="onDeleteRecord" data-date="{{item.date}}">删除</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 时间选择器弹窗 -->
  <view wx:if="{{showPicker}}" class="picker-overlay">
    <view class="picker-modal">
      <view class="picker-header">
        <text class="picker-cancel" bindtap="onPickerCancel">取消</text>
        <text class="picker-title">修改{{pickerType === 'on' ? '上班' : '下班'}}时间</text>
        <text class="picker-confirm" bindtap="onPickerConfirm">确定</text>
      </view>
      
      <view class="picker-body">
        <picker-view 
          class="picker-view"
          value="{{pickerValue}}" 
          bindchange="onPickerChange">
          <picker-view-column>
            <view wx:for="{{hours}}" wx:key="*this" class="picker-item">{{item}}</view>
          </picker-view-column>
          <picker-view-column>
            <view wx:for="{{minutes}}" wx:key="*this" class="picker-item">{{item}}</view>
          </picker-view-column>
        </picker-view>
        
        <view class="picker-indicator">
          <text class="time-display">{{hours[pickerValue[0]]}}:{{minutes[pickerValue[1]]}}</text>
        </view>
      </view>
    </view>
  </view>
</view> 