name: hours-guard-deploy

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        
      - name: Setup Node
        uses: actions/setup-node@v2
        with:
          node-version: '18'
          
      - name: Prepare Files
        run: |
          echo "æ£€æŸ¥é¡¹ç›®ç»“æ„..."
          ls -la
          if [ ! -d "public" ]; then
            echo "åˆ›å»ºpublicç›®å½•..."
            mkdir -p public
            cat > public/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-CN">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Hours Guard - å·¥æ—¶è®°å½•ç³»ç»Ÿ</title>
              <style>
                  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
                  .container { max-width: 600px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
                  h1 { color: #333; text-align: center; margin-bottom: 20px; }
                  p { color: #666; text-align: center; line-height: 1.6; }
                  .status { background: #e8f5e8; color: #2d5a2d; padding: 10px; border-radius: 4px; text-align: center; margin: 20px 0; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>ğŸ• Hours Guard</h1>
                  <h2>å·¥æ—¶è®°å½•ç³»ç»Ÿ</h2>
                  <div class="status">âœ… éƒ¨ç½²æˆåŠŸï¼</div>
                  <p>éšç§ä¼˜å…ˆçš„å·¥æ—¶è®°å½•å·¥å…·</p>
                  <p>çº¯æœ¬åœ°å­˜å‚¨ï¼Œä¿æŠ¤æ‚¨çš„éšç§</p>
                  <p><small>éƒ¨ç½²æ—¶é—´: $(date)</small></p>
              </div>
          </body>
          </html>
          EOF
          fi
          echo "publicç›®å½•å†…å®¹:"
          ls -la public/
          
      - name: Install Wrangler
        run: |
          npm install -g wrangler
          wrangler --version
          
      - name: Deploy to Cloudflare
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
        run: |
          echo "å¼€å§‹éƒ¨ç½²åˆ°Cloudflare Pages..."
          wrangler pages deploy public --project-name=hours-guard --commit-message="Gitee Goéƒ¨ç½² $(date +%Y%m%d_%H%M%S)"