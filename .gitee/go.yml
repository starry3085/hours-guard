name: Deploy to Cloudflare Pages

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

display-name: "部署到Cloudflare Pages"

steps:
- name: 检出代码
  uses: git-checkout
  
- name: 安装Node.js
  uses: node-setup
  with:
    version: '18'
    
- name: 安装Wrangler CLI
  run: |
    npm install -g wrangler
    
- name: 部署到Cloudflare Pages
  env:
    CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
    CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
  run: |
    echo "🚀 开始部署到Cloudflare Pages..."
    echo "项目: hours-guard"
    echo "提交: ${{ GITEE_COMMIT_SHA }}"
    wrangler pages deploy public --project-name=hours-guard --commit-message="Gitee自动部署: ${GITEE_COMMIT_SHA:0:7}"